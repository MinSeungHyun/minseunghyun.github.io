---
title: ViewModelì—ì„œ View(Activity, Fragment)ë¡œ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•˜ëŠ” ë°©ë²•
category: Android
tags: [Android, MVVM, ViewModel]
excerpt: ViewModelì—ì„œ Activityë¡œ ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•˜ëŠ” ì•ˆ ì¢‹ì€ ë°©ë²•ê³¼ ì´ë¥¼ í•´ê²°í•  ìˆ˜ ìˆëŠ” ë°©ë²•ë“¤(SingleLiveEvent, Event wrapper)ì„ ì•Œì•„ë´…ë‹ˆë‹¤.
header:
  teaser: /assets/images/post/6/mvvm.png
toc: true
---

**ì½ê¸° ì „ì—!**  
ë¨¼ì € [ì´ ê¸€](/android/5){:target="\_blank"}ì„ ì½ì–´ì„œ LiveDataì˜ íŠ¹ì„±ì„ ì•Œë©´ ê¸€ ì´í•´ì— ë„ì›€ì´ ë©ë‹ˆë‹¤ğŸ˜Š
{: .notice--info}

{% include figure image_path="/assets/images/post/6/mvvm.png" caption="[https://docs.microsoft.com/en-us/xamarin/xamarin-forms/enterprise-application-patterns/mvvm](https://docs.microsoft.com/en-us/xamarin/xamarin-forms/enterprise-application-patterns/mvvm)" %}

MVVM êµ¬ì¡°ì—ì„œëŠ” ViewModelì´ Viewë¥¼ ëª°ë¼ì•¼ í•©ë‹ˆë‹¤.  
ViewModelì— Viewì— ëŒ€í•œ ì°¸ì¡°ê°€ ì—†ì–´ì•¼ í•œë‹¤ëŠ” ê²ƒì¸ë°ìš”,

ê·¸ë˜ì„œ ViewModelì´ Viewì— ì´ë²¤íŠ¸ë¥¼ ì „ë‹¬í•˜ê¸° ìœ„í•´ì„  **Viewê°€ ViewModelì„ ê´€ì°°í•˜ë‹¤ê°€ ìƒíƒœ ë³€í™”ê°€ ì¼ì–´ë‚˜ë©´ ê·¸ì— ì•Œë§ì€ ì´ë²¤íŠ¸ë¥¼ ì‹¤í–‰í•˜ë„ë¡ í•´ì•¼ í•©ë‹ˆë‹¤.**

ì•ìœ¼ë¡œ ë‚˜ì˜¬ ì˜ˆì œëŠ” ViewModelì—ì„œ Activityì— ì´ë²¤íŠ¸ë¥¼ ë³´ë‚´ì„œ í† ìŠ¤íŠ¸ë¥¼ ë„ìš°ëŠ” ì½”ë“œì…ë‹ˆë‹¤.

## ì•ˆì¢‹ì€ ë°©ë²•

```kotlin
// ViewModel (TestViewModel.kt)
class TestViewModel : ViewModel() {
    private val _showErrorToast = MutableLiveData(false)

    val showErrorToast: LiveData<Boolean> = _showErrorToast

    fun onButtonClick() {
        _showErrorToast.value = true
    }

    fun showErrorToastHandled() {
        _showErrorToast.value = false
    }
}

// View (MainActivity.kt)
viewModel.showErrorToast.observe(this, Observer {
    if (it) { // ê°’ì´ trueë¡œ ë°”ë€Œë©´ ì´ë²¤íŠ¸ë¥¼ ì‹¤í–‰í•©ë‹ˆë‹¤.
        viewModel.showErrorToastHandled() // ë·°ëª¨ë¸ì—ê²Œ ì´ë²¤íŠ¸ë¥¼ ì²˜ë¦¬í–ˆë‹¤ê³  ì•Œë ¤ì„œ ê°’ì„ ë‹¤ì‹œ falseë¡œ ë°”ê¿”ì¤ë‹ˆë‹¤.
        Toast.makeText(this, R.string.error, Toast.LENGTH_SHORT).show()
    }
})
```

ì´ë ‡ê²Œ ì‚¬ìš©í•˜ë©´ ì´ë²¤íŠ¸ í•˜ë‚˜ë¥¼ ë§Œë“¤ ë•Œ ë§ˆë‹¤ LiveDataë¥¼ ë‹¤ì‹œ falseë¡œ ëŒë ¤ë†“ëŠ” ì‘ì—…ì„ í•´ì•¼í•©ë‹ˆë‹¤.  
ì½”ë“œì˜ ì–‘ë„ ëŠ˜ì–´ë‚  ë¿ë§Œ ì•„ë‹ˆë¼ ì´ë¥¼ ì‹¤ìˆ˜ë¡œ ë¹ ëœ¨ë¦¬ê¸°ë¼ë„ í•˜ë©´ ì˜¤ì‘ë™ì´ ë°œìƒí•˜ê¸° ì‰½ìŠµë‹ˆë‹¤.

---

'ê·¸ëŸ¬ë©´ ê°’ì„ trueë¡œ ë°”ê¾¸ìë§ˆì falseë¡œ ë°”ê¿”ì£¼ë©´ ë˜ëŠ”ê±° ì•„ë‹ˆì•¼..?'

```kotlin
fun onButtonClick() {
    _showErrorToast.value = true
    _showErrorToast.value = false
}
```

ì´ë ‡ê²Œ ìƒê°í•  ìˆ˜ ìˆì§€ë§Œ ì—¬ê¸°ì—” í° ë¬¸ì œê°€ ìˆìŠµë‹ˆë‹¤.  
LiveDataëŠ” lifecycleì— ë”°ë¼ì„œ í•­ìƒ observeë¥¼ í•˜ì§€ ì•Šê³  í•„ìš”í•œ ê²½ìš°ì—ë§Œ observeí•˜ê¸° ë•Œë¬¸ì— ì •ìƒì ìœ¼ë¡œ ì‘ë™í•˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.  
ë”°ë¼ì„œ ì´ ë°©ë²•ìœ¼ë¡œëŠ” ì ˆëŒ€ ì‚¬ìš©í•˜ì§€ ë§ˆì„¸ìš”.

## ê´œì°®ì€ ë°©ë²• (SingleLiveEvent)

ê´œì°®ì€ ë°©ë²•ìœ¼ë¡œëŠ” [SingleLiveEvent](https://github.com/android/architecture-samples/blob/dev-todo-mvvm-live/todoapp/app/src/main/java/com/example/android/architecture/blueprints/todoapp/SingleLiveEvent.java){:target="\_blank"}ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ìˆìŠµë‹ˆë‹¤.

### ì‚¬ìš©ë²•

```kotlin
// ViewModel (TestViewModel.kt)
class TestViewModel : ViewModel() {
    private val _showErrorToast = SingleLiveEvent<Void>()

    val showErrorToast: LiveData<Void> = _showErrorToast

    fun onButtonClick() {
        _showErrorToast.call() // _showErrorToast.value = null
    }
}

// View (MainActivity.kt)
viewModel.showErrorToast.observe(this, Observer {
    Toast.makeText(this, R.string.error, Toast.LENGTH_SHORT).show()
})
```

SingleLiveEventë¥¼ ì‚¬ìš©í•¨ìœ¼ë¡œì¨ ì½”ë“œë„ ê°„ê²°í•´ì§€ê³ , ì‚¬ìš©í•˜ê¸°ë„ ì‰¬ì›Œì¡ŒìŠµë‹ˆë‹¤.

### ë™ì‘ ë°©ì‹

```kotlin
class SingleLiveEvent<T> : MutableLiveData<T>() {
    // setValueë¡œ ìƒˆë¡œìš´ ì´ë²¤íŠ¸ë¥¼ ë°›ìœ¼ë©´ trueë¡œ ë°”ë€Œê³  ê·¸ ì´ë²¤íŠ¸ê°€ ì‹¤í–‰ë˜ë©´ falseë¡œ ëŒì•„ê°‘ë‹ˆë‹¤.
    private val isPending = AtomicBoolean(false)

    /**
     * 1. ê°’ì´ ë³€ê²½ë˜ë©´ falseì˜€ë˜ isPendingì´ trueë¡œ ë°”ë€Œê³ , Observerê°€ í˜¸ì¶œë©ë‹ˆë‹¤.
     */
    @MainThread
    override fun setValue(value: T?) {
        isPending.set(true)
        super.setValue(value)
    }

    /**
     * 2. ë‚´ë¶€ì— ë“±ë¡ëœ ObserverëŠ” isPendingì´ trueì¸ì§€ í™•ì¸í•˜ê³ ,
     *    trueì¼ ê²½ìš° ë‹¤ì‹œ falseë¡œ ëŒë ¤ ë†“ì€ í›„ì— ì´ë²¤íŠ¸ê°€ í˜¸ì¶œë˜ì—ˆë‹¤ê³  ì•Œë¦½ë‹ˆë‹¤.
     */
    @MainThread
    override fun observe(owner: LifecycleOwner, observer: Observer<in T>) {
        super.observe(owner, Observer {
            if (isPending.compareAndSet(true, false)) {
                observer.onChanged(it)
            }
        })
    }

    /**
     * Tê°€ Voidì¼ ê²½ìš° í˜¸ì¶œì„ í¸í•˜ê²Œ í•˜ê¸° ìœ„í•´ ìˆëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.
     */
    @MainThread
    fun call() {
        value = null
    }
}
```

### ë¬¸ì œì 

ì—¬ì „íˆ ë¬¸ì œì ì€ ìˆìŠµë‹ˆë‹¤.  
ë‚´ë¶€ì—ì„œ ì—¬ëŸ¬ë²ˆ í˜¸ì¶œë˜ëŠ” ê²ƒì„ ë§‰ê³  ìˆê¸° ë•Œë¬¸ì—, ì˜¤ì§ í•˜ë‚˜ì˜ ì˜µì €ë²„ë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆë‹¤ëŠ” ê²ƒì…ë‹ˆë‹¤.  
ì—¬ëŸ¬ê°œì˜ ì˜µì €ë²„ë¥¼ ë“±ë¡í•œë‹¤ í•´ë„ ê·¸ì¤‘ í•˜ë‚˜ë§Œ í˜¸ì¶œë  ê²ƒì…ë‹ˆë‹¤.

## ê¶Œì¥ë˜ëŠ” ë°©ë²• (Event wrapper)

ì§€ê¸ˆê¹Œì§€ì˜ ë¬¸ì œë¥¼ ì–´ëŠì •ë„ í•´ê²°í•œ ë°©ë²•ì¸ Event wrapper ì…ë‹ˆë‹¤.

### ì‚¬ìš©ë²•

```kotlin
// ViewModel (TestViewModel.kt)
class TestViewModel : ViewModel() {
    private val _showErrorToast = MutableLiveData<Event<Boolean>>()

    val showErrorToast: LiveData<Event<Boolean>> = _showErrorToast

    fun onButtonClick() {
        _showErrorToast.value = Event(true)
    }
}

// View (MainActivity.kt)
viewModel.showErrorToast.observe(this, Observer {
    it.getContentIfNotHandled()?.let {
        Toast.makeText(this, R.string.error, Toast.LENGTH_SHORT).show()
    }
})
```

MutableLiveDataì˜ Eventê°€ ì‹¤ì œ ê°’ì„ ê°ì‹¸ëŠ” í˜•íƒœì…ë‹ˆë‹¤.

### ë™ì‘ ë°©ì‹

```kotlin
open class Event<out T>(private val content: T) {
    var hasBeenHandled = false
        private set

    fun getContentIfNotHandled(): T? {
        return if (hasBeenHandled) { // ì´ë²¤íŠ¸ê°€ ì´ë¯¸ ì²˜ë¦¬ ë˜ì—ˆë‹¤ë©´
            null // nullì„ ë°˜í™˜í•˜ê³ ,
        } else { // ê·¸ë ‡ì§€ ì•Šë‹¤ë©´
            hasBeenHandled = true // ì´ë²¤íŠ¸ê°€ ì²˜ë¦¬ë˜ì—ˆë‹¤ê³  í‘œì‹œí•œ í›„ì—
            content // ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
        }
    }

    /**
     * ì´ë²¤íŠ¸ì˜ ì²˜ë¦¬ ì—¬ë¶€ì— ìƒê´€ ì—†ì´ ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
     */
    fun peekContent(): T = content
}
```

SingleLiveEventëŠ” Observingí•˜ëŠ” ê³¼ì •ì—ì„œ ì¼íšŒì„±ìœ¼ë¡œ ë§Œë“¤ê¸° ë•Œë¬¸ì— í•˜ë‚˜ì˜ ì˜µì €ë²„ë§Œ ê°’ì˜ ë³€ê²½ì„ ë°›ì„ ìˆ˜ ìˆì§€ë§Œ, Event wrapper ë°©ì‹ì€ Event ìì²´ê°€ ì´ë¥¼ ì œì–´í•˜ê¸° ë•Œë¬¸ì— ì—¬ëŸ¬ê°œì˜ ì˜µì €ë²„ë¥¼ ë“±ë¡í•´ë„ ëª¨ë‘ ê°’ì˜ ë³€ê²½ì„ ë°›ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ë‹¨ `getContentIfNotHandled()` ë©”ì„œë“œëŠ” í•˜ë‚˜ì˜ ì˜µì €ë²„ì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆê³ , ë‚˜ë¨¸ì§€ëŠ” `peekContent()`ë¡œ ê°’ì„ ë°›ì•„ì•¼í•©ë‹ˆë‹¤.**  
ì‚¬ì‹¤ `getContentIfNotHandled()` ë©”ì„œë“œë¥¼ ì—¬ëŸ¬ë²ˆ ì‚¬ìš©í•´ì•¼ í•˜ëŠ” ì¼ì´ ê±°ì˜ ì—†ê¸° ë•Œë¬¸ì— ì•„ì‰¬ì›Œí•  í•„ìš”ëŠ” ì—†ìŠµë‹ˆë‹¤ğŸ˜…

### ì¶”ê°€ì ì¸ ì‚¬ìš©ë²•

1.  **EventObserver**  
    ë§¤ë²ˆ ì‚¬ìš©í•  ë•Œ ë§ˆë‹¤ ìƒê¸°ëŠ” `it.getContentIfNotHandled()?.let { }` ì´ ì½”ë“œë¥¼ ì¤„ì´ê¸° ìœ„í•´ [EventObserver](https://gist.github.com/JoseAlcerreca/e0bba240d9b3cffa258777f12e5c0ae9){:target="\_blank"}ë¥¼ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

    ```kotlin
    // EventObserver.kt
    class EventObserver<T>(private val onEventUnhandledContent: (T) -> Unit) : Observer<Event<T>> {
        override fun onChanged(event: Event<T>?) {
            event?.getContentIfNotHandled()?.let { value ->
                onEventUnhandledContent(value)
            }
        }
    }

    // View (MainActivity.kt)
    viewModel.showErrorToast.observe(this, EventObserver {
        Toast.makeText(this, R.string.error, Toast.LENGTH_SHORT).show()
    })
    ```

2.  **Nullable Content**
ê°œë°œì„ í•˜ë˜ì¤‘ Eventì— nullableí•œ ê°’ì´ ë“¤ì–´ê°€ì•¼ í•˜ëŠ” ìƒí™©ì´ ë°œìƒí–ˆëŠ”ë° (ì˜ˆë¥¼ ë“¤ì–´ `MutableLiveData<Event<String?>>`) Eventì— nullì´ ë“¤ì–´ê°€ë©´ `getContentIfNotHandled()`ì˜ ê°’ë„ nullì´ ë˜ì„œ ì´ë²¤íŠ¸ë¥¼ ë°›ì„ ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.  
ê·¸ë˜ì„œ contentê°€ nullì´ì—¬ë„ ì •ìƒì ìœ¼ë¡œ ì´ë²¤íŠ¸ë¥¼ ë°›ì„ ìˆ˜ ìˆë„ë¡ Eventì™€ EventObserverë¥¼ ì•½ê°„ ì»¤ìŠ¤í…€ í–ˆëŠ”ë° í˜¹ì‹œ ë¬¸ì œê°€ ìˆê±°ë‚˜ ê°œì„ ì ì´ ìˆìœ¼ë©´ ì•Œë ¤ì£¼ì„¸ìš”ğŸ˜„
<script src="https://gist.github.com/MinSeungHyun/ee2c7a07498f58e35fcb6c0fa9c52a71.js"></script>

## ê²°ë¡ 

ì—¬ëŸ¬ê°œì˜ ì˜µì €ë²„ë¥¼ ì“¸ í•„ìš”ê°€ ì—†ë‹¤ë©´ SingleLiveDataë¡œ ì¶©ë¶„í•˜ì§€ë§Œ ì—¬ëŸ¬ê°œì˜ ì˜µì €ë²„ë¥¼ ë“±ë¡í•˜ëŠ” ì‹¤ìˆ˜ë¥¼ ë°©ì§€í•˜ê¸° ìœ„í•´ì„œ Event wrapper ë°©ì‹ì„ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ì¶”ì²œë“œë¦½ë‹ˆë‹¤.

ê¸´ ê¸€ ì½ì–´ì£¼ì…”ì„œ ê°ì‚¬í•©ë‹ˆë‹¤. í”¼ë“œë°±ì€ ë¬´ì—‡ì´ë“  í™˜ì˜ì…ë‹ˆë‹¤!

### ì°¸ê³ 

[LiveData with SnackBar, Navigation and other events (the SingleLiveEvent case)](https://medium.com/androiddevelopers/livedata-with-snackbar-navigation-and-other-events-the-singleliveevent-case-ac2622673150){:target="\_blank"}
